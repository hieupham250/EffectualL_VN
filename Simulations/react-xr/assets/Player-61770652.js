import{r as x,j as ar,F as _r,a as _e}from"./index-871a1683.js";import{M as on,a as ln,S as vn,D as sn,R as un,T as cn,b as hn,H as Ze,F as je,c as pn,d as fn,L as Sr,e as gr,f as En,g as Sn,E as gn,h as wn,i as $e,j as _n,W as mn,k as mr,l as In,m as dn,_ as Cn,V as Un,C as yn,X as Tn,n as An}from"./XR-3a18f114.js";import{C as Nn}from"./Controllers-6f94e265.js";import{R as bn}from"./RGBELoader-fdf6dfc8.js";import{B as Rn}from"./shapes-9307e4d7.js";import"./GLTFLoader-6513b2d7.js";var te=Uint8Array,me=Uint16Array,tr=Uint32Array,Ir=new te([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),dr=new te([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Mn=new te([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Cr=function(o,s){for(var f=new me(31),S=0;S<31;++S)f[S]=s+=1<<o[S-1];for(var g=new tr(f[30]),S=1;S<30;++S)for(var I=f[S];I<f[S+1];++I)g[I]=I-f[S]<<5|S;return[f,g]},Ur=Cr(Ir,2),yr=Ur[0],On=Ur[1];yr[28]=258,On[258]=28;var kn=Cr(dr,0),Fn=kn[0],ir=new me(32768);for(var B=0;B<32768;++B){var we=(B&43690)>>>1|(B&21845)<<1;we=(we&52428)>>>2|(we&13107)<<2,we=(we&61680)>>>4|(we&3855)<<4,ir[B]=((we&65280)>>>8|(we&255)<<8)>>>1}var De=function(o,s,f){for(var S=o.length,g=0,I=new me(s);g<S;++g)++I[o[g]-1];var T=new me(s);for(g=0;g<s;++g)T[g]=T[g-1]+I[g-1]<<1;var A;if(f){A=new me(1<<s);var m=15-s;for(g=0;g<S;++g)if(o[g])for(var U=g<<4|o[g],D=s-o[g],W=T[o[g]-1]++<<D,$=W|(1<<D)-1;W<=$;++W)A[ir[W]>>>m]=U}else for(A=new me(S),g=0;g<S;++g)o[g]&&(A[g]=ir[T[o[g]-1]++]>>>15-o[g]);return A},ze=new te(288);for(var B=0;B<144;++B)ze[B]=8;for(var B=144;B<256;++B)ze[B]=9;for(var B=256;B<280;++B)ze[B]=7;for(var B=280;B<288;++B)ze[B]=8;var Tr=new te(32);for(var B=0;B<32;++B)Tr[B]=5;var Bn=De(ze,9,1),Zn=De(Tr,5,1),er=function(o){for(var s=o[0],f=1;f<o.length;++f)o[f]>s&&(s=o[f]);return s},oe=function(o,s,f){var S=s/8|0;return(o[S]|o[S+1]<<8)>>(s&7)&f},rr=function(o,s){var f=s/8|0;return(o[f]|o[f+1]<<8|o[f+2]<<16)>>(s&7)},Dn=function(o){return(o/8|0)+(o&7&&1)},zn=function(o,s,f){(s==null||s<0)&&(s=0),(f==null||f>o.length)&&(f=o.length);var S=new(o instanceof me?me:o instanceof tr?tr:te)(f-s);return S.set(o.subarray(s,f)),S},xn=function(o,s,f){var S=o.length;if(!S||f&&!f.l&&S<5)return s||new te(0);var g=!s||f,I=!f||f.i;f||(f={}),s||(s=new te(S*3));var T=function(b){var fe=s.length;if(b>fe){var Ee=new te(Math.max(fe*2,b));Ee.set(s),s=Ee}},A=f.f||0,m=f.p||0,U=f.b||0,D=f.l,W=f.d,$=f.m,G=f.n,he=S*8;do{if(!D){f.f=A=oe(o,m,1);var le=oe(o,m+1,3);if(m+=3,le)if(le==1)D=Bn,W=Zn,$=9,G=5;else if(le==2){var ie=oe(o,m,31)+257,qe=oe(o,m+10,15)+4,Ke=ie+oe(o,m+5,31)+1;m+=14;for(var ye=new te(Ke),xe=new te(19),V=0;V<qe;++V)xe[Mn[V]]=oe(o,m+V*3,7);m+=qe*3;for(var Le=er(xe),Je=(1<<Le)-1,Qe=De(xe,Le,1),V=0;V<Ke;){var ee=Qe[oe(o,m,Je)];m+=ee&15;var P=ee>>>4;if(P<16)ye[V++]=P;else{var pe=0,se=0;for(P==16?(se=3+oe(o,m,3),m+=2,pe=ye[V-1]):P==17?(se=3+oe(o,m,7),m+=3):P==18&&(se=11+oe(o,m,127),m+=7);se--;)ye[V++]=pe}}var Pe=ye.subarray(0,ie),ue=ye.subarray(ie);$=er(Pe),G=er(ue),D=De(Pe,$,1),W=De(ue,G,1)}else throw"invalid block type";else{var P=Dn(m)+4,ve=o[P-4]|o[P-3]<<8,Ie=P+ve;if(Ie>S){if(I)throw"unexpected EOF";break}g&&T(U+ve),s.set(o.subarray(P,Ie),U),f.b=U+=ve,f.p=m=Ie*8;continue}if(m>he){if(I)throw"unexpected EOF";break}}g&&T(U+131072);for(var He=(1<<$)-1,We=(1<<G)-1,Ne=m;;Ne=m){var pe=D[rr(o,m)&He],q=pe>>>4;if(m+=pe&15,m>he){if(I)throw"unexpected EOF";break}if(!pe)throw"invalid length/literal";if(q<256)s[U++]=q;else if(q==256){Ne=m,D=null;break}else{var Te=q-254;if(q>264){var V=q-257,J=Ir[V];Te=oe(o,m,(1<<J)-1)+yr[V],m+=J}var de=W[rr(o,m)&We],Ce=de>>>4;if(!de)throw"invalid distance";m+=de&15;var ue=Fn[Ce];if(Ce>3){var J=dr[Ce];ue+=rr(o,m)&(1<<J)-1,m+=J}if(m>he){if(I)throw"unexpected EOF";break}g&&T(U+131072);for(var be=U+Te;U<be;U+=4)s[U]=s[U-ue],s[U+1]=s[U+1-ue],s[U+2]=s[U+2-ue],s[U+3]=s[U+3-ue];U=be}}f.l=D,f.p=Ne,f.b=U,D&&(A=1,f.m=$,f.d=W,f.n=G)}while(!A);return U==s.length?s:zn(s,0,U)},Ln=new te(0),Pn=function(o){if((o[0]&15)!=8||o[0]>>>4>7||(o[0]<<8|o[1])%31)throw"invalid zlib data";if(o[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Ye(o,s){return xn((Pn(o),o.subarray(2,-4)),s)}var Hn=typeof TextDecoder<"u"&&new TextDecoder,Wn=0;try{Hn.decode(Ln,{stream:!0}),Wn=1}catch{}const Gn=o=>o&&o.isCubeTexture;class Xn extends on{constructor(s,f){var S,g;const I=Gn(s),A=((g=I?(S=s.image[0])==null?void 0:S.width:s.image.width)!=null?g:1024)/4,m=Math.floor(Math.log2(A)),U=Math.pow(2,m),D=3*Math.max(U,16*7),W=4*U,$=[I?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/D}`,`#define CUBEUV_TEXEL_HEIGHT ${1/W}`,`#define CUBEUV_MAX_MIP ${m}.0`],G=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,he=$.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${parseInt(un.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,le={map:{value:s},height:{value:(f==null?void 0:f.height)||15},radius:{value:(f==null?void 0:f.radius)||100}},P=new ln(1,16),ve=new vn({uniforms:le,fragmentShader:he,vertexShader:G,side:sn});super(P,ve)}set radius(s){this.material.uniforms.radius.value=s}get radius(){return this.material.uniforms.radius.value}set height(s){this.material.uniforms.height.value=s}get height(){return this.material.uniforms.height.value}}const Be="colorSpace"in new cn;class Yn extends hn{constructor(s){super(s),this.type=Ze}parse(s){const Le=Math.pow(2.7182818,2.2);function Je(e,r){for(var n=0,a=0;a<65536;++a)(a==0||e[a>>3]&1<<(a&7))&&(r[n++]=a);for(var t=n-1;n<65536;)r[n++]=0;return t}function Qe(e){for(var r=0;r<16384;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}const ee={l:0,c:0,lc:0};function pe(e,r,n,a,t){for(;n<e;)r=r<<8|fr(a,t),n+=8;n-=e,ee.l=r>>n&(1<<e)-1,ee.c=r,ee.lc=n}const se=new Array(59);function Pe(e){for(var r=0;r<=58;++r)se[r]=0;for(var r=0;r<65537;++r)se[e[r]]+=1;for(var n=0,r=58;r>0;--r){var a=n+se[r]>>1;se[r]=n,n=a}for(var r=0;r<65537;++r){var t=e[r];t>0&&(e[r]=t|se[t]++<<6)}}function ue(e,r,n,a,t,i,v){for(var l=n,h=0,c=0;t<=i;t++){if(l.value-n.value>a)return!1;pe(6,h,c,e,l);var p=ee.l;if(h=ee.c,c=ee.lc,v[t]=p,p==63){if(l.value-n.value>a)throw"Something wrong with hufUnpackEncTable";pe(8,h,c,e,l);var u=ee.l+6;if(h=ee.c,c=ee.lc,t+u>i+1)throw"Something wrong with hufUnpackEncTable";for(;u--;)v[t++]=0;t--}else if(p>=59){var u=p-59+2;if(t+u>i+1)throw"Something wrong with hufUnpackEncTable";for(;u--;)v[t++]=0;t--}}Pe(v)}function He(e){return e&63}function We(e){return e>>6}function Ne(e,r,n,a){for(;r<=n;r++){var t=We(e[r]),i=He(e[r]);if(t>>i)throw"Invalid table entry";if(i>14){var v=a[t>>i-14];if(v.len)throw"Invalid table entry";if(v.lit++,v.p){var l=v.p;v.p=new Array(v.lit);for(var h=0;h<v.lit-1;++h)v.p[h]=l[h]}else v.p=new Array(1);v.p[v.lit-1]=r}else if(i)for(var c=0,h=1<<14-i;h>0;h--){var v=a[(t<<14-i)+c];if(v.len||v.p)throw"Invalid table entry";v.len=i,v.lit=r,c++}}return!0}const q={c:0,lc:0};function Te(e,r,n,a){e=e<<8|fr(n,a),r+=8,q.c=e,q.lc=r}const J={c:0,lc:0};function de(e,r,n,a,t,i,v,l,h,c){if(e==r){a<8&&(Te(n,a,t,v),n=q.c,a=q.lc),a-=8;var p=n>>a,p=new Uint8Array([p])[0];if(h.value+p>c)return!1;for(var u=l[h.value-1];p-- >0;)l[h.value++]=u}else if(h.value<c)l[h.value++]=e;else return!1;J.c=n,J.lc=a}function Ce(e){return e&65535}function be(e){var r=Ce(e);return r>32767?r-65536:r}const b={a:0,b:0};function fe(e,r){var n=be(e),a=be(r),t=a,i=n+(t&1)+(t>>1),v=i,l=i-t;b.a=v,b.b=l}function Ee(e,r){var n=Ce(e),a=Ce(r),t=n-(a>>1)&65535,i=a+t-32768&65535;b.a=i,b.b=t}function br(e,r,n,a,t,i,v){for(var l=v<16384,h=n>t?t:n,c=1,p;c<=h;)c<<=1;for(c>>=1,p=c,c>>=1;c>=1;){for(var u=0,z=u+i*(t-p),w=i*c,_=i*p,d=a*c,C=a*p,R,O,L,K;u<=z;u+=_){for(var k=u,ce=u+a*(n-p);k<=ce;k+=C){var F=k+d,H=k+w,Se=H+d;l?(fe(e[k+r],e[H+r]),R=b.a,L=b.b,fe(e[F+r],e[Se+r]),O=b.a,K=b.b,fe(R,O),e[k+r]=b.a,e[F+r]=b.b,fe(L,K),e[H+r]=b.a,e[Se+r]=b.b):(Ee(e[k+r],e[H+r]),R=b.a,L=b.b,Ee(e[F+r],e[Se+r]),O=b.a,K=b.b,Ee(R,O),e[k+r]=b.a,e[F+r]=b.b,Ee(L,K),e[H+r]=b.a,e[Se+r]=b.b)}if(n&c){var H=k+w;l?fe(e[k+r],e[H+r]):Ee(e[k+r],e[H+r]),R=b.a,e[H+r]=b.b,e[k+r]=R}}if(t&c)for(var k=u,ce=u+a*(n-p);k<=ce;k+=C){var F=k+d;l?fe(e[k+r],e[F+r]):Ee(e[k+r],e[F+r]),R=b.a,e[F+r]=b.b,e[k+r]=R}p=c,c>>=1}return u}function Rr(e,r,n,a,t,i,v,l,h,c){for(var p=0,u=0,z=l,w=Math.trunc(t.value+(i+7)/8);t.value<w;)for(Te(p,u,n,t),p=q.c,u=q.lc;u>=14;){var _=p>>u-14&16383,d=r[_];if(d.len)u-=d.len,de(d.lit,v,p,u,n,a,t,h,c,z),p=J.c,u=J.lc;else{if(!d.p)throw"hufDecode issues";var C;for(C=0;C<d.lit;C++){for(var R=He(e[d.p[C]]);u<R&&t.value<w;)Te(p,u,n,t),p=q.c,u=q.lc;if(u>=R&&We(e[d.p[C]])==(p>>u-R&(1<<R)-1)){u-=R,de(d.p[C],v,p,u,n,a,t,h,c,z),p=J.c,u=J.lc;break}}if(C==d.lit)throw"hufDecode issues"}}var O=8-i&7;for(p>>=O,u-=O;u>0;){var d=r[p<<14-u&16383];if(d.len)u-=d.len,de(d.lit,v,p,u,n,a,t,h,c,z),p=J.c,u=J.lc;else throw"hufDecode issues"}return!0}function vr(e,r,n,a,t,i){var v={value:0},l=n.value,h=Q(r,n),c=Q(r,n);n.value+=4;var p=Q(r,n);if(n.value+=4,h<0||h>=65537||c<0||c>=65537)throw"Something wrong with HUF_ENCSIZE";var u=new Array(65537),z=new Array(16384);Qe(z);var w=a-(n.value-l);if(ue(e,r,n,w,h,c,u),p>8*(a-(n.value-l)))throw"Something wrong with hufUncompress";Ne(u,h,c,z),Rr(u,z,e,r,n,p,c,i,t,v)}function Mr(e,r,n){for(var a=0;a<n;++a)r[a]=e[r[a]]}function sr(e){for(var r=1;r<e.length;r++){var n=e[r-1]+e[r]-128;e[r]=n}}function ur(e,r){for(var n=0,a=Math.floor((e.length+1)/2),t=0,i=e.length-1;!(t>i||(r[t++]=e[n++],t>i));)r[t++]=e[a++]}function cr(e){for(var r=e.byteLength,n=new Array,a=0,t=new DataView(e);r>0;){var i=t.getInt8(a++);if(i<0){var v=-i;r-=v+1;for(var l=0;l<v;l++)n.push(t.getUint8(a++))}else{var v=i;r-=2;for(var h=t.getUint8(a++),l=0;l<v+1;l++)n.push(h)}}return n}function Or(e,r,n,a,t,i){var F=new DataView(i.buffer),v=n[e.idx[0]].width,l=n[e.idx[0]].height,h=3,c=Math.floor(v/8),p=Math.ceil(v/8),u=Math.ceil(l/8),z=v-(p-1)*8,w=l-(u-1)*8,_={value:0},d=new Array(h),C=new Array(h),R=new Array(h),O=new Array(h),L=new Array(h);for(let M=0;M<h;++M)L[M]=r[e.idx[M]],d[M]=M<1?0:d[M-1]+p*u,C[M]=new Float32Array(64),R[M]=new Uint16Array(64),O[M]=new Uint16Array(p*64);for(let M=0;M<u;++M){var K=8;M==u-1&&(K=w);var k=8;for(let Z=0;Z<p;++Z){Z==p-1&&(k=z);for(let N=0;N<h;++N)R[N].fill(0),R[N][0]=t[d[N]++],kr(_,a,R[N]),Fr(R[N],C[N]),Br(C[N]);Zr(C);for(let N=0;N<h;++N)Dr(C[N],O[N],Z*64)}let Y=0;for(let Z=0;Z<h;++Z){const N=n[e.idx[Z]].type;for(let ae=8*M;ae<8*M+K;++ae){Y=L[Z][ae];for(let Ue=0;Ue<c;++Ue){const j=Ue*64+(ae&7)*8;F.setUint16(Y+0*2*N,O[Z][j+0],!0),F.setUint16(Y+1*2*N,O[Z][j+1],!0),F.setUint16(Y+2*2*N,O[Z][j+2],!0),F.setUint16(Y+3*2*N,O[Z][j+3],!0),F.setUint16(Y+4*2*N,O[Z][j+4],!0),F.setUint16(Y+5*2*N,O[Z][j+5],!0),F.setUint16(Y+6*2*N,O[Z][j+6],!0),F.setUint16(Y+7*2*N,O[Z][j+7],!0),Y+=8*2*N}}if(c!=p)for(let ae=8*M;ae<8*M+K;++ae){const Ue=L[Z][ae]+8*c*2*N,j=c*64+(ae&7)*8;for(let ge=0;ge<k;++ge)F.setUint16(Ue+ge*2*N,O[Z][j+ge],!0)}}}for(var ce=new Uint16Array(v),F=new DataView(i.buffer),H=0;H<h;++H){n[e.idx[H]].decoded=!0;var Se=n[e.idx[H]].type;if(n[H].type==2)for(var Fe=0;Fe<l;++Fe){const M=L[H][Fe];for(var ne=0;ne<v;++ne)ce[ne]=F.getUint16(M+ne*2*Se,!0);for(var ne=0;ne<v;++ne)F.setFloat32(M+ne*2*Se,E(ce[ne]),!0)}}}function kr(e,r,n){for(var a,t=1;t<64;)a=r[e.value],a==65280?t=64:a>>8==255?t+=a&255:(n[t]=a,t++),e.value++}function Fr(e,r){r[0]=E(e[0]),r[1]=E(e[1]),r[2]=E(e[5]),r[3]=E(e[6]),r[4]=E(e[14]),r[5]=E(e[15]),r[6]=E(e[27]),r[7]=E(e[28]),r[8]=E(e[2]),r[9]=E(e[4]),r[10]=E(e[7]),r[11]=E(e[13]),r[12]=E(e[16]),r[13]=E(e[26]),r[14]=E(e[29]),r[15]=E(e[42]),r[16]=E(e[3]),r[17]=E(e[8]),r[18]=E(e[12]),r[19]=E(e[17]),r[20]=E(e[25]),r[21]=E(e[30]),r[22]=E(e[41]),r[23]=E(e[43]),r[24]=E(e[9]),r[25]=E(e[11]),r[26]=E(e[18]),r[27]=E(e[24]),r[28]=E(e[31]),r[29]=E(e[40]),r[30]=E(e[44]),r[31]=E(e[53]),r[32]=E(e[10]),r[33]=E(e[19]),r[34]=E(e[23]),r[35]=E(e[32]),r[36]=E(e[39]),r[37]=E(e[45]),r[38]=E(e[52]),r[39]=E(e[54]),r[40]=E(e[20]),r[41]=E(e[22]),r[42]=E(e[33]),r[43]=E(e[38]),r[44]=E(e[46]),r[45]=E(e[51]),r[46]=E(e[55]),r[47]=E(e[60]),r[48]=E(e[21]),r[49]=E(e[34]),r[50]=E(e[37]),r[51]=E(e[47]),r[52]=E(e[50]),r[53]=E(e[56]),r[54]=E(e[59]),r[55]=E(e[61]),r[56]=E(e[35]),r[57]=E(e[36]),r[58]=E(e[48]),r[59]=E(e[49]),r[60]=E(e[57]),r[61]=E(e[58]),r[62]=E(e[62]),r[63]=E(e[63])}function Br(e){const r=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),a=.5*Math.cos(3.14159/8),t=.5*Math.cos(3*3.14159/16),i=.5*Math.cos(5*3.14159/16),v=.5*Math.cos(3*3.14159/8),l=.5*Math.cos(7*3.14159/16);for(var h=new Array(4),c=new Array(4),p=new Array(4),u=new Array(4),z=0;z<8;++z){var w=z*8;h[0]=a*e[w+2],h[1]=v*e[w+2],h[2]=a*e[w+6],h[3]=v*e[w+6],c[0]=n*e[w+1]+t*e[w+3]+i*e[w+5]+l*e[w+7],c[1]=t*e[w+1]-l*e[w+3]-n*e[w+5]-i*e[w+7],c[2]=i*e[w+1]-n*e[w+3]+l*e[w+5]+t*e[w+7],c[3]=l*e[w+1]-i*e[w+3]+t*e[w+5]-n*e[w+7],p[0]=r*(e[w+0]+e[w+4]),p[3]=r*(e[w+0]-e[w+4]),p[1]=h[0]+h[3],p[2]=h[1]-h[2],u[0]=p[0]+p[1],u[1]=p[3]+p[2],u[2]=p[3]-p[2],u[3]=p[0]-p[1],e[w+0]=u[0]+c[0],e[w+1]=u[1]+c[1],e[w+2]=u[2]+c[2],e[w+3]=u[3]+c[3],e[w+4]=u[3]-c[3],e[w+5]=u[2]-c[2],e[w+6]=u[1]-c[1],e[w+7]=u[0]-c[0]}for(var _=0;_<8;++_)h[0]=a*e[16+_],h[1]=v*e[16+_],h[2]=a*e[48+_],h[3]=v*e[48+_],c[0]=n*e[8+_]+t*e[24+_]+i*e[40+_]+l*e[56+_],c[1]=t*e[8+_]-l*e[24+_]-n*e[40+_]-i*e[56+_],c[2]=i*e[8+_]-n*e[24+_]+l*e[40+_]+t*e[56+_],c[3]=l*e[8+_]-i*e[24+_]+t*e[40+_]-n*e[56+_],p[0]=r*(e[_]+e[32+_]),p[3]=r*(e[_]-e[32+_]),p[1]=h[0]+h[3],p[2]=h[1]-h[2],u[0]=p[0]+p[1],u[1]=p[3]+p[2],u[2]=p[3]-p[2],u[3]=p[0]-p[1],e[0+_]=u[0]+c[0],e[8+_]=u[1]+c[1],e[16+_]=u[2]+c[2],e[24+_]=u[3]+c[3],e[32+_]=u[3]-c[3],e[40+_]=u[2]-c[2],e[48+_]=u[1]-c[1],e[56+_]=u[0]-c[0]}function Zr(e){for(var r=0;r<64;++r){var n=e[0][r],a=e[1][r],t=e[2][r];e[0][r]=n+1.5747*t,e[1][r]=n-.1873*a-.4682*t,e[2][r]=n+1.8556*a}}function Dr(e,r,n){for(var a=0;a<64;++a)r[n+a]=gr.toHalfFloat(zr(e[a]))}function zr(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(Le,Math.abs(e)-1)}function hr(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function xr(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(cr(r)),a=new Uint8Array(n.length);return sr(n),ur(n,a),new DataView(a.buffer)}function Ve(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),n=Ye(r),a=new Uint8Array(n.length);return sr(n),ur(n,a),new DataView(a.buffer)}function Lr(e){for(var r=e.viewer,n={value:e.offset.value},a=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),t=new Uint8Array(8192),i=0,v=new Array(e.channels),l=0;l<e.channels;l++)v[l]={},v[l].start=i,v[l].end=v[l].start,v[l].nx=e.width,v[l].ny=e.lines,v[l].size=e.type,i+=v[l].nx*v[l].ny*v[l].size;var h=Me(r,n),c=Me(r,n);if(c>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(h<=c)for(var l=0;l<c-h+1;l++)t[l+h]=Ae(r,n);var p=new Uint16Array(65536),u=Je(t,p),z=Q(r,n);vr(e.array,r,n,z,a,i);for(var l=0;l<e.channels;++l)for(var w=v[l],_=0;_<v[l].size;++_)br(a,w.start+_,w.nx,w.size,w.ny,w.nx*w.size,u);Mr(p,a,i);for(var d=0,C=new Uint8Array(a.buffer.byteLength),R=0;R<e.lines;R++)for(var O=0;O<e.channels;O++){var w=v[O],L=w.nx*w.size,K=new Uint8Array(a.buffer,w.end*2,L*2);C.set(K,d),d+=L*2,w.end+=L}return new DataView(C.buffer)}function Pr(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),n=Ye(r);const a=e.lines*e.channels*e.width,t=e.type==1?new Uint16Array(a):new Uint32Array(a);let i=0,v=0;const l=new Array(4);for(let h=0;h<e.lines;h++)for(let c=0;c<e.channels;c++){let p=0;switch(e.type){case 1:l[0]=i,l[1]=l[0]+e.width,i=l[1]+e.width;for(let u=0;u<e.width;++u){const z=n[l[0]++]<<8|n[l[1]++];p+=z,t[v]=p,v++}break;case 2:l[0]=i,l[1]=l[0]+e.width,l[2]=l[1]+e.width,i=l[2]+e.width;for(let u=0;u<e.width;++u){const z=n[l[0]++]<<24|n[l[1]++]<<16|n[l[2]++]<<8;p+=z,t[v]=p,v++}break}}return new DataView(t.buffer)}function pr(e){var r=e.viewer,n={value:e.offset.value},a=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),t={version:re(r,n),unknownUncompressedSize:re(r,n),unknownCompressedSize:re(r,n),acCompressedSize:re(r,n),dcCompressedSize:re(r,n),rleCompressedSize:re(r,n),rleUncompressedSize:re(r,n),rleRawSize:re(r,n),totalAcUncompressedCount:re(r,n),totalDcUncompressedCount:re(r,n),acCompression:re(r,n)};if(t.version<2)throw"EXRLoader.parse: "+ke.compression+" version "+t.version+" is unsupported";for(var i=new Array,v=Me(r,n)-2;v>0;){var l=Ge(r.buffer,n),h=Ae(r,n),c=h>>2&3,p=(h>>4)-1,u=new Int8Array([p])[0],z=Ae(r,n);i.push({name:l,index:u,type:z,compression:c}),v-=l.length+3}for(var w=ke.channels,_=new Array(e.channels),d=0;d<e.channels;++d){var C=_[d]={},R=w[d];C.name=R.name,C.compression=0,C.decoded=!1,C.type=R.pixelType,C.pLinear=R.pLinear,C.width=e.width,C.height=e.lines}for(var O={idx:new Array(3)},L=0;L<e.channels;++L)for(var C=_[L],d=0;d<i.length;++d){var K=i[d];C.name==K.name&&(C.compression=K.compression,K.index>=0&&(O.idx[K.index]=L),C.offset=L)}if(t.acCompressedSize>0)switch(t.acCompression){case 0:var F=new Uint16Array(t.totalAcUncompressedCount);vr(e.array,r,n,t.acCompressedSize,F,t.totalAcUncompressedCount);break;case 1:var k=e.array.slice(n.value,n.value+t.totalAcUncompressedCount),ce=Ye(k),F=new Uint16Array(ce.buffer);n.value+=t.totalAcUncompressedCount;break}if(t.dcCompressedSize>0){var H={array:e.array,offset:n,size:t.dcCompressedSize},Se=new Uint16Array(Ve(H).buffer);n.value+=t.dcCompressedSize}if(t.rleRawSize>0){var k=e.array.slice(n.value,n.value+t.rleCompressedSize),ce=Ye(k),Fe=cr(ce.buffer);n.value+=t.rleCompressedSize}for(var ne=0,M=new Array(_.length),d=0;d<M.length;++d)M[d]=new Array;for(var Y=0;Y<e.lines;++Y)for(var Z=0;Z<_.length;++Z)M[Z].push(ne),ne+=_[Z].width*e.type*2;Or(O,M,_,F,Se,a);for(var d=0;d<_.length;++d){var C=_[d];if(!C.decoded)switch(C.compression){case 2:for(var N=0,ae=0,Y=0;Y<e.lines;++Y){for(var Ue=M[d][N],j=0;j<C.width;++j){for(var ge=0;ge<2*C.type;++ge)a[Ue++]=Fe[ae+ge*C.width*C.height];ae++}N++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(a.buffer)}function Ge(e,r){for(var n=new Uint8Array(e),a=0;n[r.value+a]!=0;)a+=1;var t=new TextDecoder().decode(n.slice(r.value,r.value+a));return r.value=r.value+a+1,t}function Hr(e,r,n){var a=new TextDecoder().decode(new Uint8Array(e).slice(r.value,r.value+n));return r.value=r.value+n,a}function Wr(e,r){var n=Re(e,r),a=Q(e,r);return[n,a]}function Gr(e,r){var n=Q(e,r),a=Q(e,r);return[n,a]}function Re(e,r){var n=e.getInt32(r.value,!0);return r.value=r.value+4,n}function Q(e,r){var n=e.getUint32(r.value,!0);return r.value=r.value+4,n}function fr(e,r){var n=e[r.value];return r.value=r.value+1,n}function Ae(e,r){var n=e.getUint8(r.value);return r.value=r.value+1,n}const re=function(e,r){let n;return"getBigInt64"in DataView.prototype?n=Number(e.getBigInt64(r.value,!0)):n=e.getUint32(r.value+4,!0)+Number(e.getUint32(r.value,!0)<<32),r.value+=8,n};function X(e,r){var n=e.getFloat32(r.value,!0);return r.value+=4,n}function Xr(e,r){return gr.toHalfFloat(X(e,r))}function E(e){var r=(e&31744)>>10,n=e&1023;return(e>>15?-1:1)*(r?r===31?n?NaN:1/0:Math.pow(2,r-15)*(1+n/1024):6103515625e-14*(n/1024))}function Me(e,r){var n=e.getUint16(r.value,!0);return r.value+=2,n}function Yr(e,r){return E(Me(e,r))}function $r(e,r,n,a){for(var t=n.value,i=[];n.value<t+a-1;){var v=Ge(r,n),l=Re(e,n),h=Ae(e,n);n.value+=3;var c=Re(e,n),p=Re(e,n);i.push({name:v,pixelType:l,pLinear:h,xSampling:c,ySampling:p})}return n.value+=1,i}function qr(e,r){var n=X(e,r),a=X(e,r),t=X(e,r),i=X(e,r),v=X(e,r),l=X(e,r),h=X(e,r),c=X(e,r);return{redX:n,redY:a,greenX:t,greenY:i,blueX:v,blueY:l,whiteX:h,whiteY:c}}function Kr(e,r){var n=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],a=Ae(e,r);return n[a]}function Jr(e,r){var n=Q(e,r),a=Q(e,r),t=Q(e,r),i=Q(e,r);return{xMin:n,yMin:a,xMax:t,yMax:i}}function Qr(e,r){var n=["INCREASING_Y"],a=Ae(e,r);return n[a]}function Vr(e,r){var n=X(e,r),a=X(e,r);return[n,a]}function jr(e,r){var n=X(e,r),a=X(e,r),t=X(e,r);return[n,a,t]}function en(e,r,n,a,t){if(a==="string"||a==="stringvector"||a==="iccProfile")return Hr(r,n,t);if(a==="chlist")return $r(e,r,n,t);if(a==="chromaticities")return qr(e,n);if(a==="compression")return Kr(e,n);if(a==="box2i")return Jr(e,n);if(a==="lineOrder")return Qr(e,n);if(a==="float")return X(e,n);if(a==="v2f")return Vr(e,n);if(a==="v3f")return jr(e,n);if(a==="int")return Re(e,n);if(a==="rational")return Wr(e,n);if(a==="timecode")return Gr(e,n);if(a==="preview")return n.value+=t,"skipped";n.value+=t}function rn(e,r,n){const a={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";a.version=e.getUint8(4);const t=e.getUint8(5);a.spec={singleTile:!!(t&2),longName:!!(t&4),deepFormat:!!(t&8),multiPart:!!(t&16)},n.value=8;for(var i=!0;i;){var v=Ge(r,n);if(v==0)i=!1;else{var l=Ge(r,n),h=Q(e,n),c=en(e,r,n,l,h);c===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${l}'.`):a[v]=c}}if(t&-5)throw console.error("EXRHeader:",a),"THREE.EXRLoader: provided file is currently unsupported.";return a}function nn(e,r,n,a,t){const i={size:0,viewer:r,array:n,offset:a,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[Be?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":i.lines=1,i.uncompress=hr;break;case"RLE_COMPRESSION":i.lines=1,i.uncompress=xr;break;case"ZIPS_COMPRESSION":i.lines=1,i.uncompress=Ve;break;case"ZIP_COMPRESSION":i.lines=16,i.uncompress=Ve;break;case"PIZ_COMPRESSION":i.lines=32,i.uncompress=Lr;break;case"PXR24_COMPRESSION":i.lines=16,i.uncompress=Pr;break;case"DWAA_COMPRESSION":i.lines=32,i.uncompress=pr;break;case"DWAB_COMPRESSION":i.lines=256,i.uncompress=pr;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(i.scanlineBlockSize=i.lines,i.type==1)switch(t){case je:i.getter=Yr,i.inputSize=2;break;case Ze:i.getter=Me,i.inputSize=2;break}else if(i.type==2)switch(t){case je:i.getter=X,i.inputSize=4;break;case Ze:i.getter=Xr,i.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+i.type+" for "+e.compression+".";i.blockCount=(e.dataWindow.yMax+1)/i.scanlineBlockSize;for(var v=0;v<i.blockCount;v++)re(r,a);i.outputChannels=i.channels==3?4:i.channels;const l=i.width*i.height*i.outputChannels;switch(t){case je:i.byteArray=new Float32Array(l),i.channels<i.outputChannels&&i.byteArray.fill(1,0,l);break;case Ze:i.byteArray=new Uint16Array(l),i.channels<i.outputChannels&&i.byteArray.fill(15360,0,l);break;default:console.error("THREE.EXRLoader: unsupported type: ",t);break}return i.bytesPerLine=i.width*i.inputSize*i.channels,i.outputChannels==4?i.format=pn:i.format=fn,Be?i.colorSpace="srgb-linear":i.encoding=3e3,i}const Xe=new DataView(s),an=new Uint8Array(s),Oe={value:0},ke=rn(Xe,s,Oe),y=nn(ke,Xe,an,Oe,this.type),Er={value:0},tn={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<y.height/y.scanlineBlockSize;e++){const r=Q(Xe,Oe);y.size=Q(Xe,Oe),y.lines=r+y.scanlineBlockSize>y.height?y.height-r:y.scanlineBlockSize;const a=y.size<y.lines*y.bytesPerLine?y.uncompress(y):hr(y);Oe.value+=y.size;for(let t=0;t<y.scanlineBlockSize;t++){const i=t+e*y.scanlineBlockSize;if(i>=y.height)break;for(let v=0;v<y.channels;v++){const l=tn[ke.channels[v].name];for(let h=0;h<y.width;h++){Er.value=(t*(y.channels*y.width)+v*y.width+h)*y.inputSize;const c=(y.height-1-i)*(y.width*y.outputChannels)+h*y.outputChannels+l;y.byteArray[c]=y.getter(a,Er)}}}}return{header:ke,width:y.width,height:y.height,data:y.byteArray,format:y.format,[Be?"colorSpace":"encoding"]:y[Be?"colorSpace":"encoding"],type:this.type}}setDataType(s){return this.type=s,this}load(s,f,S,g){function I(T,A){Be?T.colorSpace=A.colorSpace:T.encoding=A.encoding,T.minFilter=Sr,T.magFilter=Sr,T.generateMipmaps=!1,T.flipY=!1,f&&f(T,A)}return super.load(s,I,S,g)}}const nr={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},$n="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",wr=o=>Array.isArray(o);function Ar({files:o=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:s="",preset:f=void 0,encoding:S=void 0,extensions:g}={}){var I;let T=null,A=!1,m;if(f){if(!(f in nr))throw new Error("Preset must be one of: "+Object.keys(nr).join(", "));o=nr[f],s=$n}if(A=wr(o),m=wr(o)?"cube":o.startsWith("data:application/exr")?"exr":o.startsWith("data:application/hdr")?"hdr":(I=o.split(".").pop())==null?void 0:I.toLowerCase(),T=A?wn:m==="hdr"?bn:m==="exr"?Yn:null,!T)throw new Error("useEnvironment: Unrecognized file extension: "+o);const U=En(T,A?[o]:o,G=>{G.setPath==null||G.setPath(s),g&&g(G)}),D=A?U[0]:U;D.mapping=A?Sn:gn;const W=3001,$=3e3;return"colorSpace"in D?D.colorSpace=S??A?"srgb":"srgb-linear":D.encoding=S??A?W:$,D}const qn=o=>o.current&&o.current.isScene,Kn=o=>qn(o)?o.current:o;function or(o,s,f,S,g=0){const I=Kn(s||f),T=I.background,A=I.environment,m=I.backgroundBlurriness||0;return o!=="only"&&(I.environment=S),o&&(I.background=S),o&&I.backgroundBlurriness!==void 0&&(I.backgroundBlurriness=g),()=>{o!=="only"&&(I.environment=A),o&&(I.background=T),o&&I.backgroundBlurriness!==void 0&&(I.backgroundBlurriness=m)}}function lr({scene:o,background:s=!1,blur:f,map:S}){const g=$e(I=>I.scene);return x.useLayoutEffect(()=>{if(S)return or(s,o,g,S,f)},[g,o,S,s,f]),null}function Nr({background:o=!1,scene:s,blur:f,...S}){const g=Ar(S),I=$e(T=>T.scene);return x.useLayoutEffect(()=>or(o,s,I,g,f),[g,o,s,I,f]),null}function Jn({children:o,near:s=1,far:f=1e3,resolution:S=256,frames:g=1,map:I,background:T=!1,blur:A,scene:m,files:U,path:D,preset:W=void 0,extensions:$}){const G=$e(ie=>ie.gl),he=$e(ie=>ie.scene),le=x.useRef(null),[P]=x.useState(()=>new _n),ve=x.useMemo(()=>{const ie=new mn(S);return ie.texture.type=Ze,ie},[S]);x.useLayoutEffect(()=>(g===1&&le.current.update(G,P),or(T,m,he,ve.texture,A)),[o,P,ve.texture,m,he,T,g,G]);let Ie=1;return mr(()=>{(g===1/0||Ie<g)&&(le.current.update(G,P),Ie++)}),x.createElement(x.Fragment,null,In(x.createElement(x.Fragment,null,o,x.createElement("cubeCamera",{ref:le,args:[s,f,ve]}),U||W?x.createElement(Nr,{background:!0,files:U,preset:W,path:D,extensions:$}):I?x.createElement(lr,{background:!0,map:I,extensions:$}):null),P))}function Qn(o){var s,f,S,g;const I=Ar(o),T=o.map||I;x.useMemo(()=>dn({GroundProjectedEnvImpl:Xn}),[]);const A=x.useMemo(()=>[T],[T]),m=(s=o.ground)==null?void 0:s.height,U=(f=o.ground)==null?void 0:f.radius,D=(S=(g=o.ground)==null?void 0:g.scale)!==null&&S!==void 0?S:1e3;return x.createElement(x.Fragment,null,x.createElement(lr,Cn({},o,{map:T})),x.createElement("groundProjectedEnvImpl",{args:A,scale:D,height:m,radius:U}))}function Vn(o){return o.ground?x.createElement(Qn,o):o.map?x.createElement(lr,o):o.children?x.createElement(Jn,o):x.createElement(Nr,o)}function jn(){const o=An(s=>s.player);return mr(()=>void(o.rotation.y+=5e-4)),ar(_r,{children:[_e(Vn,{preset:"sunset",background:!0}),_e(Rn,{position:[0,.8,-1],args:[.4,.1,.1]})]})}function oa(){return ar(_r,{children:[_e(Un,{}),_e(yn,{children:ar(Tn,{children:[_e("ambientLight",{intensity:.5}),_e("pointLight",{position:[5,5,5]}),_e(Nn,{}),_e(jn,{})]})})]})}export{oa as default};
